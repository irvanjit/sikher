<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script type="text/javascript" src="../Scripts/datajs-1.0.3-patched.js"></script>
    <script type="text/javascript">

        function atomBatchWrite() {
            var reqWrapper = {
                headers: {
                    'Content-Type': 'multipart/mixed'
                },
                data: {
                    __batchRequests: [
                        //{
                        //    __changeRequests: [
                                {
                                    headers: {
                                        'Content-Id': 1,
                                        'X-Content-Type-Options': 'nosniff',
                                        'Cache-Control': 'no-cache',
                                        'Content-Type': 'application/atom+xml',
                                        //'Content-Type': 'application/json;odata=verbose;charset=utf-8',
                                        'Location': 'http://asdasda.asdasd.hu',
                                    },
                                    statusName: 'Created',
                                    statusCode: 201,
                                    data: {
                                        Name: 'John',
                                        Age: 13,
                                        Description: 'asdasdasdasd',
                                        Id: 'asdasdasdads',
                                        Category: {
                                            __deferred: {
                                                uri: "http://asdasda.asdasd.hu/asd/People('asdasdasdads')/Category"
                                            }
                                        },
                                        __metadata: {
                                            uri: "http://asdasda.asdasd.hu/asd/People('asdasdasdads')",
                                            id: "http://asdasda.asdasd.hu/asd/People('asdasdasdads')",
                                            type: 'alma.Person'
                                        }
                                    }
                                },
                                {
                                    headers: {
                                        'Content-Id': 2,
                                        'X-Content-Type-Options': 'nosniff',
                                        'Cache-Control': 'no-cache'
                                    },
                                    statusName: 'No Content',
                                    statusCode: 204,
                                }
                            ]
                        }
                //    ]
                //}
            };



            //OData.batchServerAtomHandler.write(reqWrapper, {});
            OData.batchServerHandler.write(reqWrapper, {});

            console.log(reqWrapper);

            var i = 5;
        }
        //atomBatchWrite();

        function atomBatchRead() {
            var s = '--batch_8899452e-b757-4db5-ba02-f59d543d3eaf\r\n' +
            'Content-Type: multipart/mixed; boundary=changeset_6360a7ed-5020-45f0-9681-f5533e3631c2\r\n\r\n' +

            '--changeset_6360a7ed-5020-45f0-9681-f5533e3631c2\r\n' +
            'Content-Type: application/http\r\n' +
            'Content-Transfer-Encoding: binary\r\n\r\n' +

            'POST http://192.168.1.119:3001/testservice/People HTTP/1.1\r\n' +
            'Content-ID: 1\r\n' +
            'Content-Type: application/atom+xml\r\n' +
            'DataServiceVersion: 1.0;NetFx\r\n' +
            'MaxDataServiceVersion: 2.0;NetFx\r\n\r\n' +

            '<?xml version="1.0" encoding="utf-8"?><entry xmlns="http://www.w3.org/2005/Atom" xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"><category term="exampleSrv.PersonSrv" scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme" /><id /><title /><updated>2012-08-27T15:38:06Z</updated><author><name /></author><content type="application/xml"><m:properties><d:Age m:type="Edm.Int32">123</d:Age><d:Description>qweqe</d:Description><d:Id m:null="true" /><d:Name>asdasd</d:Name></m:properties></content></entry>\r\n' +
            '--changeset_6360a7ed-5020-45f0-9681-f5533e3631c2--\r\n' +
            '--batch_8899452e-b757-4db5-ba02-f59d543d3eaf--';

            var s2 = "\r\n" +
                        "--batch_04cf-ab35-2b70\r\n" +
                        "Content-Type: multipart/mixed; boundary=changeset_a353-8569-dc6c\r\n" +
                        "\r\n" +
                        "--changeset_a353-8569-dc6c\r\n" +
                        "Content-Type: application/http\r\n" +
                        "Content-Transfer-Encoding: binary\r\n" +
                        "\r\n" +
                        "DELETE People('NTAzY2FhNjFhMWQxYTJiZDI2MDAwNWIx') HTTP/1.1\r\n" +
                        "Content-Id: 1\r\n" +
                        "Accept: application/atomsvc+xml;q=0.8, application/json;odata=verbose;q=0.5, */*;q=0.1\r\n" +
                        "MaxDataServiceVersion: 2.0\r\n" +
                        "\r\n" +
                        "\r\n" +
                        "--changeset_a353-8569-dc6c\r\n" +
                        "Content-Type: application/http\r\n" +
                        "Content-Transfer-Encoding: binary\r\n" +
                        "\r\n" +
                        "DELETE Orders('NTAzY2FhNjFhMWQxYTJiZDI2MDAwNWFm') HTTP/1.1\r\n" +
                        "Content-Id: 19\r\n" +
                        "Accept: application/atomsvc+xml;q=0.8, application/json;odata=verbose;q=0.5, */*;q=0.1\r\n" +
                        "MaxDataServiceVersion: 2.0\r\n" +
                        "\r\n" +
                        "\r\n" +
                        "--changeset_a353-8569-dc6c\r\n" +
                        "Content-Type: application/http\r\n" +
                        "Content-Transfer-Encoding: binary\r\n" +
                        "\r\n" +
                        "DELETE Orders('NTAzY2FhNjFhMWQxYTJiZDI2MDAwNWIw') HTTP/1.1\r\n" +
                        "Content-Id: 20\r\n" +
                        "Accept: application/atomsvc+xml;q=0.8, application/json;odata=verbose;q=0.5, */*;q=0.1\r\n" +
                        "MaxDataServiceVersion: 2.0\r\n" +
                        "\r\n" +
                        "\r\n" +
                        "--changeset_a353-8569-dc6c--\r\n" +
                        "\r\n" +
                        "--batch_04cf-ab35-2b70--";

            var s3 =    "--batch_bf746ec7-9c95-4542-9718-0b11dc0a5108\r\n" +
                        "Content-Type: application/http\r\n" +
                        "Content-Transfer-Encoding: binary\r\n" +
                        "\r\n" +
                        "GET http://192.168.1.119:3001/testservice/People('NTAzY2M0NmEwYjk4NGNkYTRiMDAwMDAx') HTTP/1.1\r\n" +
                        "MaxDataServiceVersion: 2.0;NetFx\r\n" +
                        "\r\n" +
                        "\r\n" +
                        "--batch_bf746ec7-9c95-4542-9718-0b11dc0a5108--"

            var reqWrapper = {
                body: s,
                headers: {
                    'Content-Type': 'multipart/mixed; boundary=batch_8899452e-b757-4db5-ba02-f59d543d3eaf'
                    //'Content-Type': 'multipart/mixed; boundary=batch_04cf-ab35-2b70'
                    //'Content-Type': 'multipart/mixed; boundary=batch_bf746ec7-9c95-4542-9718-0b11dc0a5108'
                }
            }
            //OData.batchServerAtomHandler.read(reqWrapper, {});
            OData.batchServerHandler.read(reqWrapper, {});
            console.log(reqWrapper);

            var i = 5;
        }
        atomBatchRead();

    </script>
</head>
<body>
</body>
</html>
